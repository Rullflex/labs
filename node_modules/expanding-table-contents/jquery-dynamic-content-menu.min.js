!function(factory){"function"==typeof define&&define.amd&&define.amd.jQuery?define(["jquery"],factory):"undefined"!=typeof module&&module.exports?factory(require("jquery")):factory(jQuery)}((function($){"use strict";var VERSION="1.0.0",PLUGIN_NS="DynamicContentMenu",PLUGIN_NAME="dynamicContentMenu",pluginClassName=PLUGIN_NAME,pluginFocusClassName="active",pluginHideClassName=PLUGIN_NAME+"_hide",headerClassName=PLUGIN_NAME+"__header",headerClass="."+headerClassName,subheaderClassName=PLUGIN_NAME+"__subheader",subheaderClass="."+subheaderClassName,itemClassName=PLUGIN_NAME+"__item",itemClass="."+itemClassName,extendPageClassName=PLUGIN_NAME+"__extend-page",extendPageClass="."+extendPageClassName,DynamicContentMenu=function(element,options){this.options=options,this.$element=$(element),this._create(element)};function Plugin(option,_relatedTarget){var self=this;return this.each((function(){var $this=$(this),instance=$this.data(PLUGIN_NS),options=$.extend({},DynamicContentMenu.DEFAULTS,$this.data(),"object"==typeof option&&option);instance||$this.data(PLUGIN_NS,instance=new DynamicContentMenu(this,options)),"string"==typeof option?($.isFunction(instance[option])&&"_"!==option.charAt(0)||$.error("no such method '"+option+"' for "+PLUGIN_NAME+" plugin instance"),instance[option](Array.prototype.slice.call(arguments,1))):instance||$.error("Plugin must be initialised before using method: "+option)}))}DynamicContentMenu.DEFAULTS={context:"body",ignoreSelector:null,selectors:"h1, h2, h3",showAndHide:!0,showEffect:"slideDown",showEffectSpeed:"medium",hideEffect:"slideUp",hideEffectSpeed:"medium",smoothScroll:!0,smoothScrollSpeed:"medium",scrollTo:0,showAndHideOnScroll:!0,highlightOnScroll:!0,highlightOffset:40,theme:"material",extendPage:!0,extendPageOffset:100,history:!0,scrollHistory:!1,hashGenerator:"compact",highlightDefault:!0},DynamicContentMenu.prototype._create=function(element){var self=this;self.extendPageScroll=!0,self.items=[],self._generateHtmlMenu(),self._addCSSTheme(),self._addCSSClasses(),self.webkit=function(){for(var prop in window)if(prop&&-1!==prop.toLowerCase().indexOf("webkit"))return!0;return!1}(),self._setEventHandlers(),$(window).on("load",(function(e){self._setActiveElement(!0),$("html, body").promise().done((function(){setTimeout((function(){self.extendPageScroll=!1}),0)}))}))},DynamicContentMenu.prototype._generateHtmlMenu=function(){var self=this,firstElem,ul,ignoreSelector=self.options.ignoreSelector;(firstElem=-1!==this.options.selectors.indexOf(",")?$(this.options.context).find(this.options.selectors.replace(/ /g,"").substr(0,this.options.selectors.indexOf(","))):$(this.options.context).find(this.options.selectors.replace(/ /g,""))).length?(self.$element.addClass(pluginClassName),firstElem.each((function(index){$(this).is(ignoreSelector)||(ul=$("<ul/>",{id:headerClassName+index,class:headerClassName}).append(self._nestElements($(this),index)),self.$element.append(ul),$(this).nextUntil(this.nodeName.toLowerCase()).each((function(){0===$(this).find(self.options.selectors).length?$(this).filter(self.options.selectors).each((function(){$(this).is(ignoreSelector)||self._appendSubheaders.call(this,self,ul)})):$(this).find(self.options.selectors).each((function(){$(this).is(ignoreSelector)||self._appendSubheaders.call(this,self,ul)}))})))}))):self.$element.addClass(pluginHideClassName)},DynamicContentMenu.prototype._setActiveElement=function(pageload){var self=this,hash=window.location.hash.substring(1),elem=this.$element.find('li[data-unique="'+hash+'"]');return hash.length?(this.$element.find("."+this.focusClass).removeClass(this.focusClass),elem.addClass(this.focusClass),this.options.showAndHide&&elem.click()):(this.$element.find("."+this.focusClass).removeClass(this.focusClass),!hash.length&&pageload&&this.options.highlightDefault&&this.$element.find(itemClass).first().addClass(this.focusClass)),this},DynamicContentMenu.prototype._nestElements=function(self,index){var arr,item,hashValue;return(arr=$.grep(this.items,(function(item){return item===self.text()}))).length?this.items.push(self.text()+index):this.items.push(self.text()),hashValue=this._generateHashValue(arr,self,index),item=$("<li/>",{class:itemClassName,"data-unique":hashValue}).append($("<a/>",{text:self.text()})),self.before($("<div/>",{name:hashValue,"data-unique":hashValue})),item},DynamicContentMenu.prototype._generateHashValue=function(arr,self,index){var hashValue="",hashGeneratorOption=this.options.hashGenerator;if("pretty"===hashGeneratorOption){for(hashValue=self.text().toLowerCase().replace(/\s/g,"-");hashValue.indexOf("--")>-1;)hashValue=hashValue.replace(/--/g,"-");for(;hashValue.indexOf(":-")>-1;)hashValue=hashValue.replace(/:-/g,"-")}else hashValue="function"==typeof hashGeneratorOption?hashGeneratorOption(self.text(),self):self.text().replace(/\s/g,"");return arr.length&&(hashValue+=""+index),hashValue},DynamicContentMenu.prototype._appendSubheaders=function(self,ul){var index=$(this).index(self.options.selectors),previousHeader=$(self.options.selectors).eq(index-1),currentTagName=+$(this).prop("tagName").charAt(1),previousTagName=+previousHeader.prop("tagName").charAt(1),lastSubheader;currentTagName<previousTagName?self.$element.find(subheaderClass+"[data-tag="+currentTagName+"]").last().append(self._nestElements($(this),index)):currentTagName===previousTagName?ul.find(itemClass).last().after(self._nestElements($(this),index)):ul.find(itemClass).last().after($("<ul/>",{class:subheaderClassName,"data-tag":currentTagName})).next(subheaderClass).append(self._nestElements($(this),index))},DynamicContentMenu.prototype._setEventHandlers=function(){var self=this,$self,duration;this.$element.on("click."+PLUGIN_NS,"li",(function(event){if(self.options.history&&(window.location.hash=$(this).attr("data-unique")),self.$element.find("."+self.focusClass).removeClass(self.focusClass),$(this).addClass(self.focusClass),self.options.showAndHide){var elem=$('li[data-unique="'+$(this).attr("data-unique")+'"]');self._triggerShow(elem)}self._scrollTo($(this))})),this.$element.find("li").on({"mouseenter.DynamicContentMenu":function(){$(this).addClass(self.hoverClass),$(this).css("cursor","pointer")},"mouseleave.DynamicContentMenu":function(){"bootstrap"!==self.options.theme&&$(this).removeClass(self.hoverClass)}}),(self.options.extendPage||self.options.highlightOnScroll||self.options.scrollHistory||self.options.showAndHideOnScroll)&&$(window).on("scroll.DynamicContentMenu",(function(){$("html, body").promise().done((function(){var winScrollTop=$(window).scrollTop(),winHeight=$(window).height(),docHeight=$(document).height(),scrollHeight=$("body")[0].scrollHeight,elem,lastElem,lastElemOffset,currentElem;if(self.options.extendPage&&(self.webkit&&winScrollTop>=scrollHeight-winHeight-self.options.extendPageOffset||!self.webkit&&winHeight+winScrollTop>docHeight-self.options.extendPageOffset)&&!$(extendPageClass).length){if(!(lastElem=$('div[data-unique="'+$(itemClass).last().attr("data-unique")+'"]')).length)return;lastElemOffset=lastElem.offset().top,$(self.options.context).append($("<div />",{class:extendPageClassName,height:Math.abs(lastElemOffset-winScrollTop)+"px","data-unique":extendPageClassName})),self.extendPageScroll&&(currentElem=self.$element.find("li.active"),self._scrollTo($('div[data-unique="'+currentElem.attr("data-unique")+'"]')))}setTimeout((function(){var closestAnchorDistance=null,closestAnchorIdx=null,anchors=$(self.options.context).find("div[data-unique]"),anchorText;anchors.each((function(idx){var distance=Math.abs(($(this).next().length?$(this).next():$(this)).offset().top-winScrollTop-self.options.highlightOffset);if(!(null==closestAnchorDistance||distance<closestAnchorDistance))return!1;closestAnchorDistance=distance,closestAnchorIdx=idx})),anchorText=$(anchors[closestAnchorIdx]).attr("data-unique"),elem=$('li[data-unique="'+anchorText+'"]'),self.options.highlightOnScroll&&elem.length&&(self.$element.find("."+self.focusClass).removeClass(self.focusClass),elem.addClass(self.focusClass)),self.options.scrollHistory&&window.location.hash!=="#"+anchorText&&window.location.replace("#"+anchorText),self.options.showAndHideOnScroll&&self.options.showAndHide&&self._triggerShow(elem,!0)}),0)}))}))},DynamicContentMenu.prototype.show=function(elem,scroll){var self=this,element=elem;if(!elem.is(":visible"))switch(elem.find(subheaderClass).length||elem.parent().is(headerClass)||elem.parent().is(":visible")?elem.children(subheaderClass).length||elem.parent().is(headerClass)||(elem=elem.closest(subheaderClass)):elem=elem.parents(subheaderClass).add(elem),this.options.showEffect){case"none":elem.show();break;case"show":elem.show(this.options.showEffectSpeed);break;case"slideDown":elem.slideDown(this.options.showEffectSpeed);break;case"fadeIn":elem.fadeIn(this.options.showEffectSpeed);break;default:elem.show()}return elem.parent().is(headerClass)?this.hide($(subheaderClass).not(elem)):this.hide($(subheaderClass).not(elem.closest(headerClass).find(subheaderClass).not(elem.siblings()))),this},DynamicContentMenu.prototype.hide=function(elem){var self=this;switch(this.options.hideEffect){case"none":elem.hide();break;case"hide":elem.hide(this.options.hideEffectSpeed);break;case"slideUp":elem.slideUp(this.options.hideEffectSpeed);break;case"fadeOut":elem.fadeOut(this.options.hideEffectSpeed);break;default:elem.hide()}return this},DynamicContentMenu.prototype._triggerShow=function(elem,scroll){var self=this;return elem.parent().is(headerClass)||elem.next().is(subheaderClass)?this.show(elem.next(subheaderClass),scroll):elem.parent().is(subheaderClass)&&this.show(elem.parent(),scroll),this},DynamicContentMenu.prototype._addCSSTheme=function(){return"material"===this.options.theme&&this.$element.addClass("scod-theme-material"),this},DynamicContentMenu.prototype._addCSSClasses=function(){return this.$element.find(headerClass+","+subheaderClass).addClass("scod-flex-container"),this.focusClass="active",this},DynamicContentMenu.prototype.setOption=function(){$.Widget.prototype._setOption.apply(this,arguments)},DynamicContentMenu.prototype.setOptions=function(){$.Widget.prototype._setOptions.apply(this,arguments)},DynamicContentMenu.prototype._scrollTo=function(elem){var self=this,duration=this.options.smoothScroll||0,scrollTo=this.options.scrollTo,currentDiv=$('div[data-unique="'+elem.attr("data-unique")+'"]');return currentDiv.length?($("html, body").promise().done((function(){$("html, body").animate({scrollTop:currentDiv.offset().top-($.isFunction(scrollTo)?scrollTo.call():scrollTo)+"px"},{duration:duration})})),this):this};var old=$.fn[PLUGIN_NAME];$.fn[PLUGIN_NAME]=Plugin,$.fn[PLUGIN_NAME].Constructor=DynamicContentMenu,$.fn[PLUGIN_NAME].noConflict=function(){return $.fn[PLUGIN_NAME]=old,this}}));